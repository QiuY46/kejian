<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据挖掘：分类 (Classification) 互动学习</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 修复 1: 引入 prop-types 依赖，解决 Recharts 内部的 TypeError -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.js"></script>
    <!-- 引入 Recharts 图表库 (使用明确的稳定版本 2.12.7) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <!-- 引入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 Lucide 图标 -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .canvas-container {
            cursor: crosshair;
            touch-action: none;
        }
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        
        // 修复 2: 确保从全局 window 对象安全地获取 Recharts 库对象，解决 ReferenceError
        const Recharts = window.Recharts || {};

        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine, AreaChart, Area } = Recharts;

        // --- 图标组件 ---
        const Icons = {
            Brain: () => <i data-lucide="brain" className="w-5 h-5"></i>,
            Activity: () => <i data-lucide="activity" className="w-5 h-5"></i>,
            Target: () => <i data-lucide="target" className="w-5 h-5"></i>,
            GitBranch: () => <i data-lucide="git-branch" className="w-5 h-5"></i>,
            BarChart: () => <i data-lucide="bar-chart-2" className="w-5 h-5"></i>,
            Layers: () => <i data-lucide="layers" className="w-5 h-5"></i>,
            Filter: () => <i data-lucide="filter" className="w-5 h-5"></i>,
            Sigma: () => <i data-lucide="sigma" className="w-5 h-5"></i>,
        };

        // --- 导航组件 ---
        const Navbar = ({ activeTab, setActiveTab }) => {
            const tabs = [
                { id: 'intro', label: '核心概念', icon: Icons.Brain },
                { id: 'prep', label: '数据预处理', icon: Icons.Filter },
                { id: 'knn', label: 'KNN 演示', icon: Icons.Target },
                { id: 'methods', label: '算法详解', icon: Icons.GitBranch },
                { id: 'eval', label: '模型评估', icon: Icons.BarChart },
            ];

            useEffect(() => {
                lucide.createIcons();
            }, []);

            useEffect(() => {
                lucide.createIcons();
            }, [activeTab]);

            return (
                <nav className="fixed bottom-0 md:top-0 left-0 w-full md:w-64 md:h-screen bg-slate-900 text-white flex md:flex-col shadow-2xl z-50 transition-all duration-300">
                    <div className="hidden md:flex p-6 items-center gap-3 border-b border-slate-800">
                        <div className="bg-blue-600 p-2 rounded-lg">
                            <Icons.Activity />
                        </div>
                        <div>
                            <span className="font-bold text-lg block">DataMining</span>
                            <span className="text-xs text-slate-400 block">Classification Lab</span>
                        </div>
                    </div>
                    
                    <div className="flex-1 flex md:flex-col overflow-x-auto md:overflow-visible">
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className={`flex-1 md:flex-none p-4 md:px-6 md:py-4 flex flex-col md:flex-row items-center md:gap-4 transition-all duration-200 hover:bg-slate-800 border-t-4 md:border-t-0 md:border-r-4 
                                ${activeTab === tab.id ? 'border-blue-500 bg-slate-800 text-blue-400' : 'border-transparent text-slate-400'}`}
                            >
                                <tab.icon />
                                <span className="text-xs md:text-sm font-medium mt-1 md:mt-0 whitespace-nowrap">{tab.label}</span>
                            </button>
                        ))}
                    </div>
                </nav>
            );
        };

        // --- 模块：核心概念 ---
        const IntroModule = () => {
            return (
                <div className="space-y-6 fade-in">
                    <div className="glass-panel p-8 border-l-4 border-blue-500">
                        <h1 className="text-3xl font-bold text-slate-800 mb-4">分类 (Classification)</h1>
                        <p className="text-lg text-slate-600">
                            分类是一种数据分析形式，它提取描述重要数据类的模型。其目标是预测分类（离散、无序）的类标号。
                        </p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="glass-panel p-6">
                            <h3 className="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                                <span className="bg-blue-100 text-blue-600 p-1 rounded"><Icons.Brain/></span>
                                分类 vs 预测
                            </h3>
                            <div className="space-y-4">
                                <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <div className="font-bold text-blue-800 mb-1">分类 (Classification)</div>
                                    <div className="text-sm text-slate-600">构建模型以预测<strong>离散的</strong>类标号（categorical class labels）。</div>
                                    <div className="mt-2 text-xs text-blue-600 font-mono bg-white p-2 rounded">例：银行贷款 -> {`{安全, 风险}`}</div>
                                </div>
                                <div className="bg-purple-50 p-4 rounded-lg border border-purple-100">
                                    <div className="font-bold text-purple-800 mb-1">预测 (Prediction)</div>
                                    <div className="text-sm text-slate-600">建立模型以预测<strong>连续的</strong>数值（continuous valued function）。</div>
                                    <div className="mt-2 text-xs text-purple-600 font-mono bg-white p-2 rounded">例：下周支出 -> $135.50</div>
                                </div>
                            </div>
                        </div>

                        <div className="glass-panel p-6">
                            <h3 className="font-bold text-slate-800 text-lg mb-4">分类的两个步骤</h3>
                            <div className="relative pl-8 border-l-2 border-slate-200 space-y-8">
                                <div className="relative">
                                    <div className="absolute -left-[41px] top-0 bg-blue-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold">1</div>
                                    <h4 className="font-bold text-slate-700">模型构建 (Learning)</h4>
                                    <p className="text-sm text-slate-500 mt-1">描述预定义的数据类集或概念集。使用训练数据集（Training Set）来建立模型。</p>
                                    <div className="mt-2 text-xs bg-slate-100 p-2 rounded text-slate-600">
                                        Input: 训练数据 + 标签<br/>
                                        Output: 分类规则 / 决策树 / 数学公式
                                    </div>
                                </div>
                                <div className="relative">
                                    <div className="absolute -left-[41px] top-0 bg-green-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold">2</div>
                                    <h4 className="font-bold text-slate-700">模型使用 (Classification)</h4>
                                    <p className="text-sm text-slate-500 mt-1">使用模型对将来的或未知的对象进行分类。需先评估模型的准确率。</p>
                                    <div className="mt-2 text-xs bg-slate-100 p-2 rounded text-slate-600">
                                        Input: 测试数据 (Test Set)<br/>
                                        Output: 预测的类别
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 模块：数据预处理 (新增) ---
        const PrepModule = () => {
            return (
                <div className="space-y-6 fade-in">
                    <div className="glass-panel p-8">
                        <h2 className="text-2xl font-bold text-slate-800 mb-2">分类中的关键问题 (Issues)</h2>
                        <p className="text-slate-600 mb-6">在进行分类之前，数据预处理是至关重要的一步，它直接影响模型的准确性和效率。</p>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {/* 数据清洗 */}
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:border-blue-300 transition-colors group">
                                <div className="w-10 h-10 bg-amber-100 text-amber-600 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <i data-lucide="eraser" className="w-6 h-6"></i>
                                </div>
                                <h3 className="font-bold text-slate-800 mb-2">1. 数据清洗 (Cleaning)</h3>
                                <p className="text-sm text-slate-500 mb-3">处理噪音数据和缺失值。</p>
                                <ul className="text-xs text-slate-400 space-y-1 list-disc list-inside">
                                    <li>填充缺失值 (Mean/Median)</li>
                                    <li>平滑噪音数据 (Binning)</li>
                                    <li>纠正不一致数据</li>
                                </ul>
                            </div>

                            {/* 相关性分析 */}
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:border-blue-300 transition-colors group">
                                <div className="w-10 h-10 bg-cyan-100 text-cyan-600 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <i data-lucide="search" className="w-6 h-6"></i>
                                </div>
                                <h3 className="font-bold text-slate-800 mb-2">2. 相关性分析 (Relevance)</h3>
                                <p className="text-sm text-slate-500 mb-3">特征选择，移除无关或冗余的属性。</p>
                                <ul className="text-xs text-slate-400 space-y-1 list-disc list-inside">
                                    <li>去除冗余特征 (Correlation)</li>
                                    <li>特征子集选择</li>
                                    <li>提高模型构建速度</li>
                                </ul>
                            </div>

                            {/* 数据转换 */}
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:border-blue-300 transition-colors group">
                                <div className="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <i data-lucide="arrow-right-left" className="w-6 h-6"></i>
                                </div>
                                <h3 className="font-bold text-slate-800 mb-2">3. 数据转换 (Transformation)</h3>
                                <p className="text-sm text-slate-500 mb-3">将数据概化或规范化。</p>
                                <ul className="text-xs text-slate-400 space-y-1 list-disc list-inside">
                                    <li>归一化 (Normalization)</li>
                                    <li>概念分层 (Concept Hierarchy)</li>
                                    <li>[0, 1] 区间映射</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    {/* 归一化演示 */}
                    <div className="glass-panel p-6 flex flex-col md:flex-row gap-8 items-center">
                        <div className="flex-1">
                            <h3 className="font-bold text-lg text-slate-800 mb-2">为什么需要归一化？</h3>
                            <p className="text-sm text-slate-600 mb-4">
                                如果不同特征的数值范围差异很大（例如：年龄 0-100，收入 0-100000），基于距离的算法（如KNN）会被大数值特征主导。
                            </p>
                            <div className="bg-slate-100 p-3 rounded text-xs font-mono text-slate-500">
                                Min-Max Normalization:<br/>
                                v' = (v - min) / (max - min)
                            </div>
                        </div>
                        <div className="flex-1 h-32 flex items-end gap-4 border-b-2 border-slate-300 pb-1 px-4 relative">
                            <div className="w-8 bg-blue-400 h-[80%] relative group">
                                <span className="absolute -top-6 left-0 text-xs text-slate-500 whitespace-nowrap">收入(未处理)</span>
                            </div>
                            <div className="w-8 bg-green-400 h-[10%] relative group">
                                <span className="absolute -top-6 left-0 text-xs text-slate-500 whitespace-nowrap">年龄</span>
                            </div>
                            
                            <div className="absolute right-0 top-10 text-slate-400">
                                <i data-lucide="arrow-right" className="inline-block mx-2"></i>
                                归一化
                                <i data-lucide="arrow-right" className="inline-block mx-2"></i>
                            </div>

                            <div className="w-8 bg-blue-400 h-[40%] ml-auto opacity-50"></div>
                            <div className="w-8 bg-green-400 h-[45%] opacity-50"></div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 模块：KNN 演示 (保持原样，优秀的可视化) ---
        const KNNDemo = () => {
            const canvasRef = useRef(null);
            const [points, setPoints] = useState([
                {x: 100, y: 100, type: 'A'}, {x: 120, y: 80, type: 'A'}, {x: 150, y: 150, type: 'A'},
                {x: 300, y: 300, type: 'B'}, {x: 280, y: 320, type: 'B'}, {x: 350, y: 250, type: 'B'},
                {x: 200, y: 300, type: 'B'}, {x: 100, y: 250, type: 'A'}
            ]);
            const [kValue, setKValue] = useState(3);
            const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
            const [prediction, setPrediction] = useState(null);

            const getDist = (p1, p2) => Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));

            const handleCanvasClick = (e) => {
                const rect = canvasRef.current.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const type = Math.random() > 0.5 ? 'A' : 'B';
                setPoints([...points, { x, y, type }]);
            };

            const handleMouseMove = (e) => {
                const rect = canvasRef.current.getBoundingClientRect();
                setMousePos({
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                });
            };

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                ctx.strokeStyle = '#e2e8f0';
                ctx.lineWidth = 1;
                for(let i=0; i<canvas.width; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }
                for(let i=0; i<canvas.height; i+=40) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke(); }

                const distances = points.map(p => ({ ...p, dist: getDist(p, mousePos) }));
                distances.sort((a, b) => a.dist - b.dist);
                const neighbors = distances.slice(0, kValue);

                let countA = 0;
                let countB = 0;
                neighbors.forEach(n => n.type === 'A' ? countA++ : countB++);
                setPrediction(countA > countB ? 'A' : (countB > countA ? 'B' : 'Tie'));

                points.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 8, 0, 2 * Math.PI);
                    ctx.fillStyle = p.type === 'A' ? '#3b82f6' : '#ef4444'; 
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });

                if (mousePos.x > 0 && mousePos.y > 0) {
                    ctx.beginPath();
                    ctx.arc(mousePos.x, mousePos.y, 12, 0, 2 * Math.PI);
                    ctx.fillStyle = countA > countB ? 'rgba(59, 130, 246, 0.5)' : (countB > countA ? 'rgba(239, 68, 68, 0.5)' : 'rgba(156, 163, 175, 0.5)');
                    ctx.fill();
                    ctx.stroke();

                    neighbors.forEach(n => {
                        ctx.beginPath();
                        ctx.moveTo(mousePos.x, mousePos.y);
                        ctx.lineTo(n.x, n.y);
                        ctx.strokeStyle = n.type === 'A' ? 'rgba(59, 130, 246, 0.4)' : 'rgba(239, 68, 68, 0.4)';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    });
                    
                    if(neighbors.length > 0) {
                        const maxDist = neighbors[neighbors.length-1].dist;
                        ctx.beginPath();
                        ctx.arc(mousePos.x, mousePos.y, maxDist, 0, 2*Math.PI);
                        ctx.strokeStyle = 'rgba(100,116,139, 0.2)';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                }
            }, [points, kValue, mousePos]);

            return (
                <div className="flex flex-col h-full gap-6 fade-in">
                    <div className="glass-panel p-6">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                            <div>
                                <h2 className="text-2xl font-bold text-slate-800">K-最近邻 (KNN)</h2>
                                <p className="text-slate-600 text-sm mt-1">
                                    核心思想：<strong>近朱者赤，近墨者黑</strong>。基于距离的惰性学习算法。
                                </p>
                            </div>
                            <div className="mt-4 md:mt-0 bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200">
                                <label className="text-sm font-bold text-slate-700 mr-2">K 值:</label>
                                <input 
                                    type="range" min="1" max="9" step="2" 
                                    value={kValue} 
                                    onChange={(e) => setKValue(parseInt(e.target.value))}
                                    className="accent-blue-600 align-middle"
                                />
                                <span className="ml-2 font-mono text-lg text-blue-600 font-bold">{kValue}</span>
                            </div>
                        </div>

                        <div className="flex flex-col lg:flex-row gap-6">
                            <div className="relative bg-white rounded-xl shadow-inner border border-slate-200 overflow-hidden cursor-crosshair">
                                <canvas 
                                    ref={canvasRef} 
                                    width={600} 
                                    height={400}
                                    onClick={handleCanvasClick}
                                    onMouseMove={handleMouseMove}
                                    className="w-full h-auto"
                                />
                                <div className="absolute bottom-2 left-2 text-xs text-slate-400 pointer-events-none bg-white/80 px-2 rounded">
                                    点击画布添加随机数据点 | 移动鼠标查看分类结果
                                </div>
                            </div>

                            <div className="flex-1 space-y-4">
                                <div className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                                    <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider mb-2">当前预测</h3>
                                    <div className="flex items-center gap-4">
                                        <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold text-white transition-colors duration-300
                                            ${prediction === 'A' ? 'bg-blue-500' : (prediction === 'B' ? 'bg-red-500' : 'bg-slate-400')}`}>
                                            {prediction || '?'}
                                        </div>
                                        <div>
                                            <div className="text-slate-800 font-bold text-lg">
                                                {prediction === 'A' ? '属于蓝色类' : (prediction === 'B' ? '属于红色类' : '不确定')}
                                            </div>
                                            <div className="text-slate-500 text-sm">基于最近的 {kValue} 个邻居投票</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 模块：常用算法 (扩充：决策树与逻辑回归演示) ---
        const MethodsModule = () => {
            const [activeMethod, setActiveMethod] = useState('tree');

            // 逻辑回归模拟数据
            const sigmoidData = [];
            for (let i = -6; i <= 6; i += 0.5) {
                sigmoidData.push({
                    x: i,
                    y: 1 / (1 + Math.exp(-i)),
                    linear: i * 0.15 + 0.5 
                });
            }

            // 检查 Recharts 组件是否可用
            if (!LineChart) {
                return (
                    <div className="glass-panel p-6 text-red-500">
                        图表组件加载失败。请检查网络连接或浏览器控制台是否有错误信息。
                    </div>
                );
            }

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex gap-2 overflow-x-auto pb-2">
                        {[
                            {id: 'tree', name: '决策树 (Decision Tree)'},
                            {id: 'logistic', name: '逻辑回归 (Logistic)'},
                            {id: 'bayes', name: '贝叶斯 (Bayesian)'},
                            {id: 'nn', name: '神经网络 (NN)'}
                        ].map(m => (
                            <button 
                                key={m.id}
                                onClick={() => setActiveMethod(m.id)}
                                className={`px-4 py-2 rounded-full text-sm font-bold transition-all whitespace-nowrap
                                    ${activeMethod === m.id 
                                        ? 'bg-blue-600 text-white shadow-md' 
                                        : 'bg-white text-slate-600 hover:bg-slate-100'}`}
                            >
                                {m.name}
                            </button>
                        ))}
                    </div>

                    <div className="glass-panel p-6 min-h-[400px]">
                        {activeMethod === 'tree' && (
                            <div className="animate-fade-in">
                                <h3 className="text-xl font-bold text-slate-800 mb-2">决策树 (Decision Tree)</h3>
                                <p className="text-sm text-slate-600 mb-6">
                                    基于树形结构进行决策。PPT中的经典案例：<strong>成绩评级 (Grading)</strong>。
                                    通过一系列 "If-Then" 规则将数据层层划分。
                                </p>
                                
                                {/* 决策树可视化 */}
                                <div className="flex flex-col items-center">
                                    <div className="bg-slate-800 text-white px-6 py-3 rounded-lg shadow-md mb-4 font-mono">
                                        分数 &ge; 90 ?
                                    </div>
                                    <div className="flex w-full max-w-lg justify-between relative">
                                        <div className="w-1/2 border-t-2 border-slate-300 h-8 absolute top-0 left-0 rounded-tl-lg"></div>
                                        <div className="w-1/2 border-t-2 border-slate-300 h-8 absolute top-0 right-0 rounded-tr-lg"></div>
                                        
                                        <div className="flex flex-col items-center w-1/2 -mt-4 z-10">
                                            <span className="bg-white px-2 text-xs text-green-600 font-bold mb-1">Yes</span>
                                            <div className="bg-green-100 border-2 border-green-500 text-green-700 px-4 py-2 rounded-lg">
                                                Grade A
                                            </div>
                                        </div>

                                        <div className="flex flex-col items-center w-1/2 -mt-4 z-10">
                                            <span className="bg-white px-2 text-xs text-red-600 font-bold mb-1">No</span>
                                            <div className="bg-slate-700 text-white px-4 py-2 rounded-lg shadow-sm font-mono text-sm mb-4">
                                                分数 &ge; 80 ?
                                            </div>
                                            
                                            {/* Sub tree */}
                                            <div className="flex w-48 justify-between relative">
                                                <div className="w-1/2 border-t-2 border-slate-300 h-6 absolute top-0 left-0"></div>
                                                <div className="w-1/2 border-t-2 border-slate-300 h-6 absolute top-0 right-0"></div>
                                                
                                                <div className="flex flex-col items-center -mt-3">
                                                    <span className="bg-white px-1 text-[10px] text-green-600">Yes</span>
                                                    <div className="bg-blue-100 border border-blue-400 text-blue-700 px-2 py-1 rounded text-xs">Grade B</div>
                                                </div>
                                                <div className="flex flex-col items-center -mt-3">
                                                    <span className="bg-white px-1 text-[10px] text-red-600">No</span>
                                                    <div className="bg-slate-200 text-slate-500 px-2 py-1 rounded text-xs">...</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeMethod === 'logistic' && (
                            <div className="animate-fade-in">
                                <h3 className="text-xl font-bold text-slate-800 mb-2">逻辑回归 (Logistic Regression)</h3>
                                <p className="text-sm text-slate-600 mb-4">
                                    虽然叫“回归”，但通过 <strong>Sigmoid 函数</strong> 将线性回归的输出压缩到 [0,1] 之间，从而用于二分类。
                                </p>
                                <div className="h-64 w-full bg-white rounded-xl border border-slate-200 p-2">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={sigmoidData} margin={{ top: 5, right: 20, bottom: 5, left: 0 }}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                                            <XAxis dataKey="x" type="number" domain={['dataMin', 'dataMax']} tick={false} />
                                            <YAxis domain={[0, 1.2]} />
                                            <Tooltip />
                                            <ReferenceLine y={0.5} stroke="red" strokeDasharray="3 3" label="阈值 (0.5)" />
                                            <Line type="monotone" dataKey="y" stroke="#3b82f6" strokeWidth={3} dot={false} name="Sigmoid (概率)" />
                                            <Line type="monotone" dataKey="linear" stroke="#cbd5e1" strokeWidth={2} strokeDasharray="5 5" dot={false} name="Linear (无界)" />
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>
                                <p className="text-xs text-slate-400 text-center mt-2">
                                    {`蓝线将无界的线性输入转化为概率。Y > 0.5 判为正类，Y < 0.5 判为负类。`}
                                </p>
                            </div>
                        )}

                        {activeMethod === 'bayes' && (
                            <div className="animate-fade-in">
                                <h3 className="text-xl font-bold text-slate-800 mb-2">贝叶斯分类 (Bayesian)</h3>
                                <p className="text-sm text-slate-600 mb-4">
                                    基于统计学的分类方法。利用<strong>贝叶斯定理</strong>计算样本属于某类别的后验概率。
                                </p>
                                <div className="bg-yellow-50 p-4 rounded border border-yellow-200 text-center my-6">
                                    <p className="font-serif text-xl text-slate-800">P(H|X) = <span className="border-b border-slate-800">P(X|H) · P(H)</span> / P(X)</p>
                                    <p className="text-xs text-slate-500 mt-2">后验概率 = (似然度 × 先验概率) / 标准化常量</p>
                                </div>
                                <div className="grid grid-cols-2 gap-4 text-sm">
                                    <div className="bg-white p-3 rounded shadow-sm">
                                        <div className="font-bold text-green-600">优点</div>
                                        <div>计算速度快，对缺失数据不敏感。</div>
                                    </div>
                                    <div className="bg-white p-3 rounded shadow-sm">
                                        <div className="font-bold text-red-500">缺点</div>
                                        <div>假设属性之间相互独立（朴素贝叶斯），这在现实中往往不成立。</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeMethod === 'nn' && (
                            <div className="animate-fade-in">
                                <h3 className="text-xl font-bold text-slate-800 mb-2">神经网络 (Neural Networks)</h3>
                                <p className="text-sm text-slate-600 mb-4">
                                    模拟生物神经系统。由输入层、隐藏层和输出层组成。通过反向传播算法调整权重。
                                </p>
                                <div className="flex justify-center gap-8 my-8 opacity-80">
                                    <div className="flex flex-col gap-2 justify-center">
                                        {[1,2,3].map(i => <div key={i} className="w-8 h-8 rounded-full bg-slate-300 border-2 border-slate-400"></div>)}
                                        <span className="text-xs text-center">Input</span>
                                    </div>
                                    <div className="flex flex-col justify-center relative w-16">
                                        {/* Lines (Mock) */}
                                        <div className="absolute inset-0 border-t border-b border-slate-200 skew-y-12 opacity-50"></div>
                                        <div className="absolute inset-0 border-t border-b border-slate-200 -skew-y-12 opacity-50"></div>
                                    </div>
                                    <div className="flex flex-col gap-2 justify-center">
                                        {[1,2,3,4].map(i => <div key={i} className="w-8 h-8 rounded-full bg-blue-200 border-2 border-blue-400"></div>)}
                                        <span className="text-xs text-center">Hidden</span>
                                    </div>
                                    <div className="flex flex-col justify-center relative w-16">
                                        <div className="absolute inset-0 border-t border-b border-slate-200 skew-y-6 opacity-50"></div>
                                    </div>
                                    <div className="flex flex-col gap-2 justify-center">
                                        {[1,2].map(i => <div key={i} className="w-8 h-8 rounded-full bg-green-200 border-2 border-green-400"></div>)}
                                        <span className="text-xs text-center">Output</span>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- 模块：模型评估 (新增 ROC/AUC & 混淆矩阵) ---
        const EvalModule = () => {
            const [tp, setTp] = useState(50);
            const [tn, setTn] = useState(40);
            const [fp, setFp] = useState(10);
            const [fn, setFn] = useState(5);
            const [subTab, setSubTab] = useState('matrix');

            const total = tp + tn + fp + fn;
            const accuracy = ((tp + tn) / total).toFixed(3);
            const precision = (tp / (tp + fp)).toFixed(3);
            const recall = (tp / (tp + fn)).toFixed(3);
            
            // ROC Data Mock
            const rocData = [
                {fpr: 0, tpr: 0}, {fpr: 0.1, tpr: 0.5}, {fpr: 0.2, tpr: 0.7}, 
                {fpr: 0.3, tpr: 0.85}, {fpr: 0.5, tpr: 0.9}, {fpr: 0.8, tpr: 0.95}, {fpr: 1, tpr: 1}
            ];
            const randomLine = [{fpr: 0, tpr: 0}, {fpr: 1, tpr: 1}];

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex gap-4 border-b border-slate-200 pb-2">
                        <button onClick={() => setSubTab('matrix')} className={`text-sm font-bold pb-2 ${subTab === 'matrix' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-400'}`}>混淆矩阵</button>
                        <button onClick={() => setSubTab('roc')} className={`text-sm font-bold pb-2 ${subTab === 'roc' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-400'}`}>ROC & AUC</button>
                        <button onClick={() => setSubTab('cv')} className={`text-sm font-bold pb-2 ${subTab === 'cv' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-400'}`}>交叉验证</button>
                    </div>

                    {subTab === 'matrix' && (
                        <div className="glass-panel p-6">
                            <h2 className="text-xl font-bold text-slate-800 mb-4">混淆矩阵 (Confusion Matrix)</h2>
                            <div className="flex flex-col lg:flex-row gap-8">
                                <div className="flex-1 space-y-4">
                                    <div className="bg-white p-3 rounded border">
                                        <label className="flex justify-between text-xs font-bold text-green-600"><span>TP (真正例)</span><span>{tp}</span></label>
                                        <input type="range" max="100" value={tp} onChange={(e)=>setTp(parseInt(e.target.value))} className="w-full accent-green-600"/>
                                    </div>
                                    <div className="bg-white p-3 rounded border">
                                        <label className="flex justify-between text-xs font-bold text-slate-600"><span>TN (真负例)</span><span>{tn}</span></label>
                                        <input type="range" max="100" value={tn} onChange={(e)=>setTn(parseInt(e.target.value))} className="w-full accent-slate-600"/>
                                    </div>
                                    <div className="bg-white p-3 rounded border">
                                        <label className="flex justify-between text-xs font-bold text-red-500"><span>FP (假正例/误报)</span><span>{fp}</span></label>
                                        <input type="range" max="100" value={fp} onChange={(e)=>setFp(parseInt(e.target.value))} className="w-full accent-red-500"/>
                                    </div>
                                    <div className="bg-white p-3 rounded border">
                                        <label className="flex justify-between text-xs font-bold text-orange-500"><span>FN (假负例/漏报)</span><span>{fn}</span></label>
                                        <input type="range" max="100" value={fn} onChange={(e)=>setFn(parseInt(e.target.value))} className="w-full accent-orange-500"/>
                                    </div>
                                </div>
                                <div className="flex-1 grid grid-cols-2 gap-3">
                                    <div className="bg-blue-50 p-4 rounded border border-blue-100 text-center">
                                        <div className="text-2xl font-bold text-blue-700">{accuracy}</div>
                                        <div className="text-xs text-slate-500">Accuracy (准确率)</div>
                                    </div>
                                    <div className="bg-emerald-50 p-4 rounded border border-emerald-100 text-center">
                                        <div className="text-2xl font-bold text-emerald-700">{precision}</div>
                                        <div className="text-xs text-slate-500">Precision (精确率)</div>
                                    </div>
                                    <div className="bg-violet-50 p-4 rounded border border-violet-100 text-center">
                                        <div className="text-2xl font-bold text-violet-700">{recall}</div>
                                        <div className="text-xs text-slate-500">Recall (召回率)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {subTab === 'roc' && (
                        <div className="glass-panel p-6">
                            <h2 className="text-xl font-bold text-slate-800 mb-2">ROC 曲线与 AUC</h2>
                            <p className="text-sm text-slate-600 mb-6">
                                ROC曲线展示了分类器在不同阈值下的表现。纵轴是TPR（召回率），横轴是FPR（假正例率）。
                                <strong>曲线越靠近左上角，模型性能越好。</strong>
                            </p>
                            <div className="h-64 w-full bg-white p-4 rounded-xl border border-slate-200">
                                <ResponsiveContainer width="100%" height="100%">
                                    <AreaChart data={rocData}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="fpr" type="number" label={{ value: 'FPR (False Positive Rate)', position: 'insideBottom', offset: -5 }} />
                                        <YAxis dataKey="tpr" type="number" label={{ value: 'TPR (True Positive Rate)', angle: -90, position: 'insideLeft' }} />
                                        <Tooltip />
                                        <Area type="monotone" dataKey="tpr" stroke="#8884d8" fill="#8884d8" fillOpacity={0.3} name="Model ROC" />
                                        <Line data={randomLine} dataKey="tpr" stroke="#cbd5e1" strokeDasharray="5 5" dot={false} name="Random Guess" />
                                    </AreaChart>
                                </ResponsiveContainer>
                            </div>
                            <div className="mt-4 text-center">
                                <span className="inline-block bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-bold">
                                    AUC (Area Under Curve) ≈ 0.85
                                </span>
                            </div>
                        </div>
                    )}

                    {subTab === 'cv' && (
                        <div className="glass-panel p-6">
                            <h2 className="text-xl font-bold text-slate-800 mb-4">交叉验证 (Cross-Validation)</h2>
                            <p className="text-sm text-slate-600 mb-6">
                                k-折交叉验证：将数据分为 k 个子集。每次留一个子集作为测试集，其余作为训练集。重复 k 次。
                            </p>
                            <div className="space-y-2">
                                {[1,2,3,4,5].map(k => (
                                    <div key={k} className="flex items-center gap-2">
                                        <span className="text-xs text-slate-500 w-12">Fold {k}</span>
                                        <div className="flex-1 flex h-8 rounded overflow-hidden border border-slate-200">
                                            {[1,2,3,4,5].map(i => (
                                                <div key={i} className={`flex-1 flex items-center justify-center text-xs font-bold text-white
                                                    ${i === k ? 'bg-orange-400' : 'bg-blue-400'}`}>
                                                    {i === k ? 'Test' : 'Train'}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- 主应用组件 ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('intro');

            return (
                <div className="h-screen bg-slate-50 flex flex-col md:flex-row overflow-hidden">
                    <Navbar activeTab={activeTab} setActiveTab={setActiveTab} />
                    
                    <main className="flex-1 md:ml-64 p-4 md:p-8 overflow-y-auto h-full">
                        <div className="max-w-5xl mx-auto pb-20 md:pb-0">
                            {activeTab === 'intro' && <IntroModule />}
                            {activeTab === 'prep' && <PrepModule />}
                            {activeTab === 'knn' && <KNNDemo />}
                            {activeTab === 'methods' && <MethodsModule />}
                            {activeTab === 'eval' && <EvalModule />}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>